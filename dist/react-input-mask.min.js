!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):e.ReactInputMask=t(e.React)}(this,function(e){"use strict";function t(){var e=new RegExp("windows","i"),t=new RegExp("firefox","i"),n=new RegExp("android","i"),s=navigator.userAgent;return!e.test(s)&&!t.test(s)&&n.test(s)}function n(){var e=new RegExp("windows","i"),t=new RegExp("phone","i"),n=navigator.userAgent;return e.test(n)&&t.test(n)}function s(){var e=new RegExp("windows","i"),t=new RegExp("firefox","i"),n=new RegExp("android","i"),s=navigator.userAgent;return!e.test(s)&&t.test(s)&&n.test(s)}function o(){var e=new RegExp("windows","i"),t=new RegExp("(ipod|iphone|ipad)","i"),n=navigator.userAgent;return!e.test(n)&&t.test(n)}function a(e,t){return-1!==e.permanents.indexOf(t)}function r(e,t,n){var s=e.mask,o=e.charsRules;if(!n)return!1;if(a(e,t))return s[t]===n;var r=o[s[t]];return new RegExp(r).test(n)}function i(e,t){return t.split("").every(function(t,n){return a(e,n)||!r(e,n,t)})}function u(e,t){var n=e.maskChar,s=e.prefix;if(!n){for(;t.length>s.length&&a(e,t.length-1);)t=t.slice(0,t.length-1);return t.length}for(var o=s.length,i=t.length;i>=s.length;i--){var u=t[i];if(!a(e,i)&&r(e,i,u)){o=i+1;break}}return o}function l(e,t){return u(e,t)===e.mask.length}function p(e,t){var n=e.maskChar,s=e.mask,o=e.prefix;if(!n)return t=f(e,"",t,0),(t=t.slice(0,u(e,t))).length<o.length&&(t=o),t;if(t)return f(e,p(e,""),t,0);for(var r=0;r<s.length;r++)a(e,r)?t+=s[r]:t+=n;return t}function c(e,t,n,s){var o=n+s,r=e.maskChar,i=e.mask,u=e.prefix,l=t.split("");return r?l.map(function(t,s){return s<n||s>=o?t:a(e,s)?i[s]:r}).join(""):(n=Math.max(u.length,n),l.splice(n,o-n),t=l.join(""),p(e,t))}function f(e,t,n,s){var o=e.mask,i=e.maskChar,u=e.prefix,c=n.split(""),f=l(e,t),h=function(t,n){return!a(e,t)||n===o[t]},m=function(t,n){return!i||!a(e,n)||t!==i};return!i&&s>t.length&&(t+=o.slice(t.length,s)),c.every(function(n){for(;!h(s,n);){if(s>=t.length&&(t+=o[s]),!m(n,s))return!0;if(++s>=o.length)return!1}return!r(e,s,n)&&n!==i||(s<t.length?i||f||s<u.length?t=t.slice(0,s)+n+t.slice(s+1):(t=t.slice(0,s)+n+t.slice(s),t=p(e,t)):i||(t+=n),++s<o.length)}),t}function h(e,t,n,s){var o=e.mask,i=e.maskChar,u=n.split(""),l=s,p=function(t,n){return!a(e,t)||n===o[t]};return u.every(function(t){for(;!p(s,t);)if(++s>=o.length)return!1;return(r(e,s,t)||t===i)&&s++,s<o.length}),s-l}function m(e,t){var n={};for(var s in e)t.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s]);return n}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}e="default"in e?e["default"]:e;var v={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},O=function(e,t,n){if(t===undefined&&(t="_"),null==n&&(n=v),!e||"string"!=typeof e)return{maskChar:t,charsRules:n,mask:null,prefix:null,lastEditablePos:null,permanents:[]};var s="",o="",a=[],r=!1,i=null;return e.split("").forEach(function(e){r||"\\"!==e?(r||!n[e]?(a.push(s.length),s.length===a.length-1&&(o+=e)):i=s.length+1,s+=e,r=!1):r=!0}),{maskChar:t,charsRules:n,prefix:o,mask:s,lastEditablePos:i,permanents:a}},y=function(e){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){return setTimeout(e,0)})(e)},w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E=function(e){function t(e){g(this,t);var n=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));C.call(n);var s=e.mask,o=e.maskChar,a=e.formatChars,r=e.defaultValue,i=e.value,u=e.alwaysShowMask;return n.hasValue=null!=i,n.maskOptions=O(s,o,a),null==r&&(r=""),null==i&&(i=r),i=n.getStringValue(i),n.maskOptions.mask&&(u||i)&&(i=p(n.maskOptions,i)),n.value=i,n}return k(t,e),t}(e.Component),C=function(){var r=this;this.lastCursorPos=null,this.focused=!1,this.componentDidMount=function(){r.isAndroidBrowser=t(),r.isWindowsPhoneBrowser=n(),r.isAndroidFirefox=s(),r.isIOS=o(),r.maskOptions.mask&&r.getInputValue()!==r.value&&r.setInputValue(r.value)},this.componentWillReceiveProps=function(e){var t=r.maskOptions;if(r.hasValue=null!=e.value,r.maskOptions=O(e.mask,e.maskChar,e.formatChars),r.maskOptions.mask){var n=r.maskOptions.mask&&r.maskOptions.mask!==t.mask,s=e.alwaysShowMask||r.isFocused(),o=r.hasValue?r.getStringValue(e.value):r.value;if(t.mask||r.hasValue||(o=r.getInputDOMNode().value),(n||r.maskOptions.mask&&(o||s))&&(o=p(r.maskOptions,o),n)){var a=r.lastCursorPos,c=u(r.maskOptions,o);(null===a||c<a)&&(a=l(r.maskOptions,o)?c:r.getRightEditablePos(c),r.setCursorPos(a))}!r.maskOptions.mask||!i(r.maskOptions,o)||s||r.hasValue&&e.value||(o=""),r.value=o}else r.lastCursorPos=null},this.componentDidUpdate=function(){r.maskOptions.mask&&r.getInputValue()!==r.value&&r.setInputValue(r.value)},this.isDOMElement=function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":b(HTMLElement))?e instanceof HTMLElement:1===e.nodeType&&"string"==typeof e.nodeName},this.getInputDOMNode=function(){var t=r.input;return t?r.isDOMElement(t)?t:e.findDOMNode(t):null},this.getInputValue=function(){var e=r.getInputDOMNode();return e?e.value:null},this.setInputValue=function(e){var t=r.getInputDOMNode();t&&(r.value=e,t.value=e)},this.getLeftEditablePos=function(e){for(var t=e;t>=0;--t)if(!a(r.maskOptions,t))return t;return null},this.getRightEditablePos=function(e){for(var t=r.maskOptions.mask,n=e;n<t.length;++n)if(!a(r.maskOptions,n))return n;return null},this.setCursorToEnd=function(){var e=u(r.maskOptions,r.value),t=r.getRightEditablePos(e);null!==t&&r.setCursorPos(t)},this.setSelection=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0,n=r.getInputDOMNode();if(n){var s=e+t;if("selectionStart"in n&&"selectionEnd"in n)n.selectionStart=e,n.selectionEnd=s;else{var o=n.createTextRange();o.collapse(!0),o.moveStart("character",e),o.moveEnd("character",s-e),o.select()}}},this.getSelection=function(){var e=r.getInputDOMNode(),t=0,n=0;if("selectionStart"in e&&"selectionEnd"in e)t=e.selectionStart,n=e.selectionEnd;else{var s=document.selection.createRange();s.parentElement()===e&&(t=-s.moveStart("character",-e.value.length),n=-s.moveEnd("character",-e.value.length))}return{start:t,end:n,length:n-t}},this.getCursorPos=function(){return r.getSelection().start},this.setCursorPos=function(e){r.setSelection(e,0),y(function(){r.setSelection(e,0)}),r.lastCursorPos=e},this.isFocused=function(){return r.focused},this.getStringValue=function(e){return e||0===e?e+"":""},this.onKeyDown=function(e){r.backspaceOrDeleteRemoval=null,"function"==typeof r.props.onKeyDown&&r.props.onKeyDown(e);var t=e.key,n=e.ctrlKey,s=e.metaKey,o=e.defaultPrevented;n||s||o||"Backspace"!==t&&"Delete"!==t||(r.backspaceOrDeleteRemoval={key:t,selection:r.getSelection()},r.isIOS&&r.getInputDOMNode().parentElement(),y(function(){r.backspaceOrDeleteRemoval=null}))},this.onChange=function(e){var t=r.paste,n=r.maskOptions,s=n.mask,o=n.maskChar,a=n.lastEditablePos,i=n.prefix,l=r.getInputValue(),h=r.value;if(t)return r.paste=null,void r.pasteText(t.value,l,t.selection,e);var m,g,d=r.getSelection(),k=d.end,v=s.length,O=l.length,w=h.length;if(r.backspaceOrDeleteRemoval){var b="Delete"===r.backspaceOrDeleteRemoval.key;if(l=r.value,d=r.backspaceOrDeleteRemoval.selection,k=d.start,r.backspaceOrDeleteRemoval=null,d.length)l=c(r.maskOptions,l,d.start,d.length);else if(d.start<i.length||!b&&d.start===i.length)k=i.length;else{var E=b?r.getRightEditablePos(k):r.getLeftEditablePos(k-1);null!==E&&(l=c(r.maskOptions,l,E,1),k=E)}}else if(O>w){var C=O-w,P=d.end-C;g=l.substr(P,C),k=P<a&&(1!==C||g!==s[P])?r.getRightEditablePos(P):P,l=l.substr(0,P)+l.substr(P+C),m=c(r.maskOptions,l,P,v-P),m=f(r.maskOptions,m,g,k),l=f(r.maskOptions,h,g,k),1!==C||k>=i.length&&k<a?(k=Math.max(u(r.maskOptions,m),k))<a&&(k=r.getRightEditablePos(k)):k<a&&k++}else if(O<w){var R=v-O,x=(g=l.substr(0,d.end))===h.substr(0,d.end);m=c(r.maskOptions,h,d.end,R),o&&(l=f(r.maskOptions,m,g,0)),m=c(r.maskOptions,m,d.end,v-d.end),m=f(r.maskOptions,m,g,0),x?k<i.length&&(k=i.length):(k=Math.max(u(r.maskOptions,m),k))<a&&(k=r.getRightEditablePos(k))}l=p(r.maskOptions,l),r.setInputValue(l),"function"==typeof r.props.onChange&&r.props.onChange(e),r.isWindowsPhoneBrowser?y(function(){r.setSelection(k,0)}):r.setCursorPos(k)},this.onFocus=function(e){if(r.focused=!0,r.maskOptions.mask)if(r.value)u(r.maskOptions,r.value)<r.maskOptions.mask.length&&r.setCursorToEnd();else{var t=r.maskOptions.prefix,n=p(r.maskOptions,t),s=p(r.maskOptions,n),o=s!==e.target.value;o&&(e.target.value=s),r.value=s,o&&"function"==typeof r.props.onChange&&r.props.onChange(e),r.setCursorToEnd()}"function"==typeof r.props.onFocus&&r.props.onFocus(e)},this.onBlur=function(e){if(r.focused=!1,r.maskOptions.mask&&!r.props.alwaysShowMask&&i(r.maskOptions,r.value)){var t=""!==r.getInputValue();t&&r.setInputValue(""),t&&"function"==typeof r.props.onChange&&r.props.onChange(e)}"function"==typeof r.props.onBlur&&r.props.onBlur(e)},this.onPaste=function(e){"function"==typeof r.props.onPaste&&r.props.onPaste(e),r.isAndroidBrowser&&!e.defaultPrevented&&(r.paste={value:r.getInputValue(),selection:r.getSelection()},r.setInputValue(""))},this.pasteText=function(e,t,n,s){var o=n.start;n.length&&(e=c(r.maskOptions,e,o,n.length));var a=h(r.maskOptions,e,t,o);e=f(r.maskOptions,e,t,o),o+=a,o=r.getRightEditablePos(o)||o,e!==r.getInputValue()&&(r.setInputValue(e),s&&"function"==typeof r.props.onChange&&r.props.onChange(s)),r.setCursorPos(o)},this.render=function(){var t=r.props,n=(t.mask,t.alwaysShowMask,t.maskChar,t.formatChars,m(t,["mask","alwaysShowMask","maskChar","formatChars"]));return r.maskOptions.mask&&(n.disabled||n.readOnly||["onChange","onKeyDown","onPaste"].forEach(function(e){n[e]=r[e]}),null!=n.value&&(n.value=r.value)),e.createElement("input",w({ref:function(e){return r.input=e}},n,{onFocus:r.onFocus,onBlur:r.onBlur}))}};return E});
