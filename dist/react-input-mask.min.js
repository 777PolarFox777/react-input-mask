!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):e.ReactInputMask=t(e.React)}(this,function(e){"use strict";function t(){var e=new RegExp("windows","i"),t=new RegExp("firefox","i"),n=new RegExp("android","i"),o=navigator.userAgent;return!e.test(o)&&!t.test(o)&&n.test(o)}function n(){var e=new RegExp("windows","i"),t=new RegExp("phone","i"),n=navigator.userAgent;return e.test(n)&&t.test(n)}function o(){var e=new RegExp("windows","i"),t=new RegExp("firefox","i"),n=new RegExp("android","i"),o=navigator.userAgent;return!e.test(o)&&t.test(o)&&n.test(o)}function s(e,t){return-1!==e.permanents.indexOf(t)}function a(e,t,n){var o=e.mask,a=e.charsRules;if(!n)return!1;if(s(e,t))return o[t]===n;var r=a[o[t]];return new RegExp(r).test(n)}function r(e,t){return t.split("").every(function(t,n){return s(e,n)||!a(e,n,t)})}function i(e,t){var n=e.maskChar,o=e.prefix;if(!n)return t.length;for(var r=o.length,i=t.length;i>=o.length;i--){var u=t[i];if(!s(e,i)&&a(e,i,u)){r=i+1;break}}return r}function u(e,t){return i(e,t)===e.mask.length}function l(e,t){var n=e.maskChar,o=e.mask,a=e.prefix;if(!n)return t=c(e,"",t,0),(t=t.slice(0,i(e,t))).length<a.length&&(t=a),t;if(t)return c(e,l(e,""),t,0);for(var r=0;r<o.length;r++)s(e,r)?t+=o[r]:t+=n;return t}function p(e,t,n,o){var a=n+o,r=e.maskChar,i=e.mask,u=e.prefix,p=t.split("");return r?p.map(function(t,o){return o<n||o>=a?t:s(e,o)?i[o]:r}).join(""):(n=Math.max(u.length,n),p.splice(n,a-n),t=p.join(""),l(e,t))}function c(e,t,n,o){var r=e.mask,i=e.maskChar,p=e.prefix,c=n.split(""),f=u(e,t),h=function(t,n){return!s(e,t)||n===r[t]},m=function(t,n){return!i||!s(e,n)||t!==i};return!i&&o>t.length&&(t+=r.slice(t.length,o)),c.every(function(n){for(;!h(o,n);){if(o>=t.length&&(t+=r[o]),!m(n,o))return!0;if(++o>=r.length)return!1}return!a(e,o,n)&&n!==i||(o<t.length?i||f||o<p.length?t=t.slice(0,o)+n+t.slice(o+1):(t=t.slice(0,o)+n+t.slice(o),t=l(e,t)):i||(t+=n),++o<r.length)}),t}function f(e,t,n,o){var r=e.mask,i=e.maskChar,u=n.split(""),l=o,p=function(t,n){return!s(e,t)||n===r[t]};return u.every(function(t){for(;!p(o,t);)if(++o>=r.length)return!1;return(a(e,o,t)||t===i)&&o++,o<r.length}),o-l}function h(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}e="default"in e?e["default"]:e;var d={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},k=function(e,t,n){if(t===undefined&&(t="_"),null==n&&(n=d),!e||"string"!=typeof e)return{maskChar:t,charsRules:n,mask:null,prefix:null,lastEditablePos:null,permanents:[]};var o="",s="",a=[],r=!1,i=null;return e.split("").forEach(function(e,t){r||"\\"!==e?(r||!n[e]?(a.push(o.length),s.length===t&&(s+=e)):i=o.length+1,o+=e,r=!1):r=!0}),{maskChar:t,charsRules:n,prefix:s,mask:o,lastEditablePos:i,permanents:a}},O=function(e){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){return setTimeout(e,0)})(e)},y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=function(e){function t(e){m(this,t);var n=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));E.call(n);var o=e.mask,s=e.maskChar,a=e.formatChars,r=e.defaultValue,i=e.value,u=e.alwaysShowMask;return n.hasValue=null!=i,n.maskOptions=k(o,s,a),null==r&&(r=""),null==i&&(i=r),i=n.getStringValue(i),n.maskOptions.mask&&(u||i)&&(i=l(n.maskOptions,i)),n.value=i,n}return v(t,e),t}(e.Component),E=function(){var a=this;this.lastCursorPos=null,this.componentDidMount=function(){a.isAndroidBrowser=t(),a.isWindowsPhoneBrowser=n(),a.isAndroidFirefox=o(),a.getInputValue()!==a.value&&a.setInputValue(a.value)},this.componentWillReceiveProps=function(e){var t=a.maskOptions;if(a.hasValue=null!=e.value,a.maskOptions=k(e.mask,e.maskChar,e.formatChars),a.maskOptions.mask){var n=a.maskOptions.mask&&a.maskOptions.mask!==t.mask,o=e.alwaysShowMask||a.isFocused(),s=a.hasValue?a.getStringValue(e.value):a.value;if(t.mask||a.hasValue||(s=a.getInputDOMNode().value),(n||a.maskOptions.mask&&(s||o))&&(s=l(a.maskOptions,s),n)){var p=a.lastCursorPos,c=i(a.maskOptions,s);(null===p||c<p)&&(p=u(a.maskOptions,s)?c:a.getRightEditablePos(c),a.setCursorPos(p))}!a.maskOptions.mask||!r(a.maskOptions,s)||o||a.hasValue&&e.value||(s=""),a.value=s}else a.lastCursorPos=null},this.componentDidUpdate=function(){a.getInputValue()!==a.value&&a.setInputValue(a.value)},this.isDOMElement=function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":b(HTMLElement))?e instanceof HTMLElement:1===e.nodeType&&"string"==typeof e.nodeName},this.getInputDOMNode=function(){var t=a.input;return t?a.isDOMElement(t)?t:e.findDOMNode(t):null},this.getInputValue=function(){var e=a.getInputDOMNode();return e?e.value:null},this.setInputValue=function(e){var t=a.getInputDOMNode();t&&(a.value=e,t.value=e)},this.getLeftEditablePos=function(e){for(var t=e;t>=0;--t)if(!s(a.maskOptions,t))return t;return null},this.getRightEditablePos=function(e){for(var t=a.maskOptions.mask,n=e;n<t.length;++n)if(!s(a.maskOptions,n))return n;return null},this.setCursorToEnd=function(){var e=i(a.maskOptions,a.value),t=a.getRightEditablePos(e);null!==t&&a.setCursorPos(t)},this.setSelection=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0,n=a.getInputDOMNode();if(n){var o=e+t;if("selectionStart"in n&&"selectionEnd"in n)n.selectionStart=e,n.selectionEnd=o;else{var s=n.createTextRange();s.collapse(!0),s.moveStart("character",e),s.moveEnd("character",o-e),s.select()}}},this.getSelection=function(){var e=a.getInputDOMNode(),t=0,n=0;if("selectionStart"in e&&"selectionEnd"in e)t=e.selectionStart,n=e.selectionEnd;else{var o=document.selection.createRange();o.parentElement()===e&&(t=-o.moveStart("character",-e.value.length),n=-o.moveEnd("character",-e.value.length))}return{start:t,end:n,length:n-t}},this.getCursorPos=function(){return a.getSelection().start},this.setCursorPos=function(e){a.setSelection(e,0),O(function(){a.setSelection(e,0)}),a.lastCursorPos=e},this.isFocused=function(){return document.activeElement===a.getInputDOMNode()},this.getStringValue=function(e){return e||0===e?e+"":""},this.onKeyDown=function(e){a.backspaceOrDeleteRemoval=null,"function"==typeof a.props.onKeyDown&&a.props.onKeyDown(e);var t=e.key,n=e.ctrlKey,o=e.metaKey,s=e.defaultPrevented;n||o||s||"Backspace"!==t&&"Delete"!==t||(a.backspaceOrDeleteRemoval={key:t,selection:a.getSelection()},O(function(){a.backspaceOrDeleteRemoval=null}))},this.onChange=function(e){var t=a.paste,n=a.maskOptions,o=n.mask,s=n.maskChar,r=n.lastEditablePos,u=n.prefix,f=a.getInputValue(),h=a.value;if(t)return a.paste=null,void a.pasteText(t.value,f,t.selection,e);var m,g,v=a.getSelection(),d=v.end,k=o.length,y=f.length,b=h.length;if(a.backspaceOrDeleteRemoval){var w="Delete"===a.backspaceOrDeleteRemoval.key;if(f=a.value,v=a.backspaceOrDeleteRemoval.selection,d=v.start,a.backspaceOrDeleteRemoval=null,v.length)f=p(a.maskOptions,f,v.start,v.length);else if(v.start<u.length||!w&&v.start===u.length)d=u.length;else{var E=w?a.getRightEditablePos(d):a.getLeftEditablePos(d-1);null!==E&&(f=p(a.maskOptions,f,E,1),d=E)}}else if(y>b){var C=y-b,P=v.end-C;g=f.substr(P,C),d=P<r&&(1!==C||g!==o[P])?a.getRightEditablePos(P):P,f=f.substr(0,P)+f.substr(P+C),m=p(a.maskOptions,f,P,k-P),m=c(a.maskOptions,m,g,d),f=c(a.maskOptions,h,g,d),1!==C||d>=u.length&&d<r?(d=Math.max(i(a.maskOptions,m),d))<r&&(d=a.getRightEditablePos(d)):d<r&&d++}else if(y<b){var R=k-y,x=(g=f.substr(0,v.end))===h.substr(0,v.end);m=p(a.maskOptions,h,v.end,R),s&&(f=c(a.maskOptions,m,g,0)),m=p(a.maskOptions,m,v.end,k-v.end),m=c(a.maskOptions,m,g,0),x?d<u.length&&(d=u.length):(d=Math.max(i(a.maskOptions,m),d))<r&&(d=a.getRightEditablePos(d))}f=l(a.maskOptions,f),a.setInputValue(f),"function"==typeof a.props.onChange&&a.props.onChange(e),a.isWindowsPhoneBrowser?O(function(){a.setSelection(d,0)}):a.setCursorPos(d)},this.onFocus=function(e){if(a.value)i(a.maskOptions,a.value)<a.maskOptions.mask.length&&a.setCursorToEnd();else{var t=a.maskOptions.prefix,n=l(a.maskOptions,t),o=l(a.maskOptions,n),s=o!==e.target.value;s&&(e.target.value=o),a.value=o,s&&"function"==typeof a.props.onChange&&a.props.onChange(e),a.setCursorToEnd()}"function"==typeof a.props.onFocus&&a.props.onFocus(e)},this.onBlur=function(e){if(!a.props.alwaysShowMask&&r(a.maskOptions,a.value)){var t=""!==a.getInputValue();t&&a.setInputValue(""),t&&"function"==typeof a.props.onChange&&a.props.onChange(e)}"function"==typeof a.props.onBlur&&a.props.onBlur(e)},this.onPaste=function(e){"function"==typeof a.props.onPaste&&a.props.onPaste(e),a.isAndroidBrowser&&!e.defaultPrevented&&(a.paste={value:a.getInputValue(),selection:a.getSelection()},a.setInputValue(""))},this.pasteText=function(e,t,n,o){var s=n.start;n.length&&(e=p(a.maskOptions,e,s,n.length));var r=f(a.maskOptions,e,t,s);e=c(a.maskOptions,e,t,s),s+=r,s=a.getRightEditablePos(s)||s,e!==a.getInputValue()&&(a.setInputValue(e),o&&"function"==typeof a.props.onChange&&a.props.onChange(o)),a.setCursorPos(s)},this.render=function(){var t=a.props,n=(t.mask,t.alwaysShowMask,t.maskChar,t.formatChars,h(t,["mask","alwaysShowMask","maskChar","formatChars"]));return a.maskOptions.mask&&(n.disabled||n.readOnly||["onFocus","onBlur","onChange","onKeyDown","onPaste"].forEach(function(e){n[e]=a[e]}),null!=n.value&&(n.value=a.value)),e.createElement("input",y({ref:function(e){return a.input=e}},n))}};return w});
